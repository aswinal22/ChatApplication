{% extends 'base.html' %}
{% block content %}
<div class="container">
    <div class="message-box">
        <h2>Chat Room : {{ room }}</h2>
        <div class="messages" id="messages"></div>
        <div class="input-container">
            <input type="text" placeholder="Enter your Message" name="message" id="message" />
            <button type="button" name="send" id="send-btn" onclick="sendMessage()">Send</button>
        </div>
    </div>
</div>

<script type="text/javascript">
    var socketio = io();

    const messages = document.getElementById("messages");

    const createMessage = (name, msg) => {
        console.log("Creating message:", name, msg); // Debugging log
        if (!name || !msg) {
            console.error("Invalid message data:", { name, msg });
            return;
        }

        const content = `
        <div class="text">
            <span>
                <strong>${name}:</strong> ${msg}
            </span>
            <span class="muted">
                ${new Date().toLocaleString()}
            </span>
        </div>
        `;
        messages.innerHTML += content;
    };

    // Listen for new messages
    socketio.on("message", (data) => {
        console.log("Received message:", data);  // Debugging log
        createMessage(data.name, data.message);
    });

    // Send messages properly
    const sendMessage = () => {
        const messageInput = document.getElementById("message");
        const message = messageInput.value.trim();

        if (message === "") return; // Prevent sending empty messages

        socketio.emit("message", { message: message });

        messageInput.value = ""; // Clear input after sending
    };
</script>
{% endblock %}
